<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>週間スケジュール</title>
  <meta name="theme-color" content="#2b6cb0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="週間スケジュール">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="icon" sizes="192x192" href="/icons/icon-192.png">
  <link rel="icon" sizes="512x512" href="/icons/icon-512.png">
  <link rel="stylesheet" href="style.css">
  <meta name="mobile-web-app-capable" content="yes">

</head>

<body>
  <div class="week-navigation">
    <div class="auth-group">
      <button id="plusOpen" class="auth-plus">Plusプラン</button>
      <button id="authOpen" class="auth-open">ログイン</button>
      <button id="authAccount" class="auth-logout" disabled>アカウント設定</button>
    </div>
    <div class="week-nav-controls">
      <button id="prevWeek">←</button>
      <button id="weekLabel" class="week-label-btn" type="button">2025年10月第4週</button>
      <button id="bulkDeleteOpen" class="bulk-delete-open">一括削除</button>
      <button id="nextWeek">→</button>
    </div>
    <div class="auth-info">
      <div id="authStatus" class="auth-status">未ログイン</div>
      <div class="legal-links">
        <a href="/privacy.html" target="_blank" rel="noopener">プライバシーポリシー</a>
        <a href="/terms.html" target="_blank" rel="noopener">利用規約</a>
      </div>
      <button id="syncRefresh" class="sync-refresh" type="button">同期を有効化</button>
      <div id="syncMessage" class="sync-message" aria-live="polite"></div>
    </div>
  </div>
  <div class="week-view" id="weekView"></div>

  <!-- モーダル -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3 id="modalTitle">予定を追加</h3>

      <label>タイトル
        <input id="title" placeholder="例：アルバイト" />
      </label>

      <label>種類
        <select id="type" class="type-select-hidden" aria-hidden="true" tabindex="-1"></select>
        <div class="type-picker">
          <button id="typePickerBtn" type="button" class="type-picker-btn" aria-haspopup="listbox" aria-expanded="false">
            <span class="type-picker-swatch" aria-hidden="true"></span>
            <span class="type-picker-label">種類を選択</span>
            <span class="type-picker-arrow" aria-hidden="true">▾</span>
          </button>
          <div id="typePickerPanel" class="type-picker-panel" role="listbox" aria-hidden="true" tabindex="-1">
            <div id="typePickerList" class="type-picker-list"></div>
          </div>
        </div>
      </label>
      <button id="typeAddOpen" type="button" class="type-add-open">種類を追加</button>
      <div id="typeAddPanel" class="type-add-panel">
        <div class="type-add-row">
          <input id="typeNew" type="text" placeholder="例：ゼミ、塾 など">
          <input id="typeColor" type="color" value="#5b8def" aria-label="種類の色">
          <span id="typeColorPreview" class="color-preview" aria-label="選択中の色"></span>
          <button id="typeAdd" type="button">追加</button>
        </div>
        <div class="type-color-palette" aria-label="色のプリセット"
          style="display:flex;align-items:flex-start;gap:8px;flex-wrap:wrap;">
          <div class="type-color-grid"
            style="display:flex;flex-wrap:wrap;gap:6px 8px;align-items:center;width:262px;">
            <button type="button" class="color-swatch" data-color="#333333" style="background:#333333" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#123060" style="background:#123060" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#8b5cf6" style="background:#8b5cf6" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#5b8def" style="background:#5b8def" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#0ea5e9" style="background:#0ea5e9" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#7cc7ff" style="background:#7cc7ff" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#10b981" style="background:#10b981" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#f6c344" style="background:#f6c344" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#ff8c00" style="background:#ff8c00" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#ef4444" style="background:#ef4444" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#d97706" style="background:#d97706" aria-label="色を選択"></button>
            <button type="button" class="color-swatch" data-color="#8b5e3b" style="background:#8b5e3b" aria-label="色を選択"></button>
            <button id="typeColorFreeBtn" type="button" class="color-free" aria-label="自由に色を選ぶ">
              <img src="image/color-wheel.png" alt="" class="color-wheel-icon">
            </button>
          </div>
        </div>
        <label class="tap-toggle-row">
          <span>完了／未完了を切り替え</span>
          <span class="toggle-switch">
            <input id="tapToggle" type="checkbox">
            <span class="toggle-slider" aria-hidden="true"></span>
          </span>
        </label>
        <button id="typeAddClose" type="button" class="type-add-close">閉じる</button>
      </div>

      <label>開始時間
        <input id="start" type="time" value="09:00">
      </label>

      <label>終了時間
        <input id="end" type="time" value="10:00">
      </label>

      <label>
        繰り返し
        <select id="repeat">
          <option value="none">繰り返しなし</option>
          <option value="daily">毎日</option>
          <option value="weekly">毎週</option>
          <option value="weekday">平日のみ</option>
        </select>
      </label>
      <div class="delete-scope-row" id="deleteScopeRow">
        <label>削除対象
          <select id="deleteScope">
            <option value="single">この1件だけ削除</option>
            <option value="future">これ以降の繰り返しを削除</option>
            <option value="all">この予定をすべて削除</option>
          </select>
        </label>
      </div>

      <div class="buttons">
        <button id="save">保存</button>
        <button id="delete">削除</button>
        <button id="cancel">キャンセル</button>
      </div>
    </div>
  </div>

  <!-- 一括削除モーダル -->
  <div class="modal" id="bulkModal">
    <div class="modal-content bulk-content">
      <h3>予定をまとめて削除</h3>
      <p class="bulk-note">削除したい予定にチェックを付けてください</p>
      <div class="delete-scope-row bulk-scope-row">
        <label>削除対象
          <select id="bulkDeleteScope">
            <option value="single">この1件だけ削除</option>
            <option value="future">これ以降の繰り返しを削除</option>
            <option value="all">この予定をすべて削除</option>
          </select>
        </label>
      </div>
      <ul id="bulkList" class="bulk-list"></ul>
      <div class="buttons bulk-buttons">
        <button id="bulkDelete">選択を削除</button>
        <button id="bulkCancel">閉じる</button>
      </div>
    </div>
  </div>

  <!-- 日別ToDoパネル -->
  <div class="todo-panel" id="todoPanel" aria-hidden="true">
    <div class="todo-inner">
      <div class="todo-header">
        <h3 id="todoDateLabel">ToDo</h3>
        <button id="todoClose" class="todo-close" aria-label="閉じる">×</button>
      </div>

      <div class="todo-input-row">
        <input id="todoInput" type="text" placeholder="やることを入力してEnter…" />
        <button id="todoAdd">追加</button>
      </div>

      <div class="todo-scroll">
        <ul id="todoList" class="todo-list"></ul>

        <div class="todo-memo">
          <label for="todoMemo">メモ</label>
          <div id="todoMemoText" class="todo-memo-text"></div>
          <textarea id="todoMemo" placeholder="この日のメモを書いてください"></textarea>
          <div class="todo-memo-buttons">
            <button id="todoMemoEdit" class="muted">メモを編集</button>
            <button id="todoMemoSave" class="muted">メモを保存</button>
          </div>
        </div>
      </div>

      <div class="todo-footer">
        <button id="todoClearDone" class="muted">完了を一括削除</button>
      </div>
    </div>
  </div>

  <!-- ログインモーダル -->
  <div class="modal" id="authModal">
    <div class="modal-content auth-modal">
      <h3>ログイン</h3>
      <p class="auth-note">Plusユーザーのみログイン可能です。</p>
      <label for="authEmail">メールアドレス</label>
      <input id="authEmail" type="email" placeholder="メールアドレスを入力してください">
      <label for="authPassword">パスワード</label>
      <input id="authPassword" type="password" placeholder="パスワードを入力してください">
      <div id="authError" class="auth-error" aria-live="polite"></div>
      <div class="buttons auth-buttons">
        <button id="authLogin">ログイン</button>
        <button id="authCancel" class="muted">閉じる</button>
      </div>
      <button id="upgradeBtn" class="upgrade-link">Plusプランはこちら</button>
    </div>
  </div>

  <!-- 日付ジャンプ（カレンダー）モーダル -->
  <div class="modal" id="datePickerModal">
    <div class="date-picker-solo">
      <div class="date-picker-title">日付を選択</div>
      <div class="date-picker-row">
        <label class="date-picker-label" for="datePickerYear">年</label>
        <select id="datePickerYear" aria-label="年"></select>
        <label class="date-picker-label" for="datePickerMonth">月</label>
        <select id="datePickerMonth" aria-label="月"></select>
        <label class="date-picker-label" for="datePickerDay">日</label>
        <select id="datePickerDay" aria-label="日"></select>
        <button id="datePickerCalendarToggle" type="button" aria-label="カレンダーを開く">📅</button>
      </div>
      <div id="datePickerCalendar" class="date-picker-calendar" aria-hidden="true"></div>
      <div class="date-picker-actions">
        <button id="datePickerSearch" type="button">検索</button>
      </div>
    </div>
  </div>

  <!-- アカウント設定モーダル -->
  <div class="modal" id="accountModal">
    <div class="modal-content auth-modal account-modal">
      <h3>アカウント設定</h3>
     
        <div class="account-section">
          <button id="accountEmailToggle" class="account-toggle" type="button" aria-expanded="false">メールアドレスを変更</button>
          <div id="accountEmailFields" class="account-fields" aria-hidden="true">
            <label for="accountEmail">新しいメールアドレス</label>
            <input id="accountEmail" type="email" placeholder="example@sample.com">
            <div id="accountEmailError" class="auth-error" aria-live="polite"></div>
            <div class="account-actions">
              <button id="accountEmailUpdate" type="button">変更を保存</button>
              <button id="accountEmailClose" class="muted account-close" type="button">閉じる</button>
            </div>
          </div>
        </div>
        <div class="account-section">
          <button id="accountPasswordToggle" class="account-toggle" type="button" aria-expanded="false">パスワードを変更</button>
          <div id="accountPasswordFields" class="account-fields" aria-hidden="true">
            <label for="accountCurrentPassword">現在のパスワード</label>
            <input id="accountCurrentPassword" type="password" placeholder="現在のパスワード">
            <label for="accountNewPassword">新しいパスワード</label>
            <input id="accountNewPassword" type="password" placeholder="新しいパスワード">
            <label for="accountNewPasswordConfirm">新しいパスワード（確認）</label>
            <input id="accountNewPasswordConfirm" type="password" placeholder="新しいパスワード（確認）">
            <div id="accountPasswordError" class="auth-error" aria-live="polite"></div>
            <div class="account-actions">
              <button id="accountPasswordUpdate" type="button">変更を保存</button>
              <button id="accountPasswordClose" class="muted account-close" type="button">閉じる</button>
            </div>
          </div>
        </div>
      <div id="accountError" class="auth-error" aria-live="polite"></div>
      <div class="buttons auth-buttons">
        <button id="accountLogout" class="account-toggle">ログアウト</button>
        <button id="accountCancel" class="account-toggle">plusプランを停止</button>
      </div>
    </div>
  </div>

  <!-- Plusプラン説明モーダル -->
  <div class="modal" id="plusModal">
    <div class="modal-content auth-modal plus-modal-content">
      <h3>Plusプラン</h3>
      <p class="plus-description">複数端末でもデータが自動で保持・同期されます。</p>
      <div class="plus-illustrations">
        <figure class="plus-illust">
          <img id="plusPcImage" src="image/usingcomputer_man_mono.png" alt="PCで計画するイメージ">
          <figcaption>PCで計画</figcaption>
        </figure>
        <figure class="plus-illust">
          <img id="plusMobileImage" class="plus-illust-right" src="image/smartphone_woman_02_mono.png"
            alt="スマホでToDoを消化するイメージ">
          <figcaption>スマホでToDo消化</figcaption>
        </figure>
      </div>
      <div id="plusError" class="auth-error" aria-live="polite"></div>
      <div class="buttons auth-buttons">
        <button id="plusChange">Plusプランに変更</button>
        <button id="plusClose" class="muted">閉じる</button>
      </div>
      <button id="plusLoginOpen" class="upgrade-link">すでにアカウントをお持ちの方はこちら</button>
    </div>
  </div>

  <!-- 新規登録モーダル -->
  <div class="modal" id="signupModal">
    <div class="modal-content auth-modal">
      <h3>新規登録</h3>
      <p class="auth-note">Plusプランをご利用いただくための新規登録です。</p>
      <label for="signupEmail">メールアドレス</label>
      <input id="signupEmail" type="email" placeholder="メールアドレスを入力してください">
      <label for="signupPassword">パスワード</label>
      <input id="signupPassword" type="password" placeholder="8文字以上のパスワード">
      <label for="signupPasswordConfirm">パスワード確認</label>
      <input id="signupPasswordConfirm" type="password" placeholder="もう一度入力してください">
      <label class="terms-row">
        <input id="signupTerms" type="checkbox">
        <span><a href="/terms.html" target="_blank" rel="noopener">利用規約</a>に同意します</span>
      </label>
      <div id="signupError" class="auth-error" aria-live="polite"></div>
      <div class="buttons auth-buttons">
        <button id="signupSubmit">登録</button>
        <button id="signupCancel" class="muted">閉じる</button>
      </div>
    </div>
  </div>

  <!-- 課金モーダル（モック） -->
  <div class="modal" id="paymentModal">
    <div class="modal-content auth-modal">
      <h3>Plusプラン</h3>
      <p class="auth-note">月額240円</p>
      <div id="paymentError" class="auth-error" aria-live="polite"></div>
      <div class="buttons auth-buttons">
        <button id="paymentSubmit">支払いに進む</button>
        <button id="paymentBack" class="muted">戻る</button>
      </div>
      <p class="payment-note">※この画面はモック決済です。本番はStripe等の決済導入が必要です。</p>
    </div>
  </div>


  <!-- script.js は body の一番下 -->
  <script type="module" src="./script.js?v=20260203"></script>
  <script>
    (function () {
      if (!("serviceWorker" in navigator)) return;
      window.addEventListener("load", function () {
        navigator.serviceWorker.register("/service-worker.js", { scope: "/" })
          .catch(function (err) {
            console.warn("ServiceWorker registration failed:", err);
          });
      });
    })();
  </script>
 
</body>

</html>
